# 静态资源路径修复说明

## 🔍 问题根本原因

VitePress在配置了`base`路径后，需要使用官方提供的`withBase`函数来正确处理动态资源路径。之前的修复方法是错误的，导致了更多问题。

## ✅ 正确的修复方案

### 1. VitePress配置 (`docs/.vitepress/config.mts`)
```typescript
// 保持简洁，VitePress会自动处理静态资源
const BASE_PATH = '/kapok-docs'

export default defineConfig({
    base: BASE_PATH,
    themeConfig: {
        logo: '/logo.svg',  // 不需要手动添加base路径
        // ...
    }
})
```

### 2. 使用withBase函数 (`useTheme.ts`)
```typescript
import { withBase } from 'vitepress'

// Logo切换时使用withBase
export const switchLogo = (logoPath: string) => {
    currentLogo.value = logoPath
    
    if (typeof document !== 'undefined') {
        const logoElement = document.querySelector('.VPNavBarTitle .logo') as HTMLImageElement
        if (logoElement) {
            logoElement.src = withBase(logoPath)  // 关键修复
        }
    }
}

// 背景切换时使用withBase
watch(currentBackground, (newBg) => {
    const bgUrl = withBase(newBg)  // 关键修复
    document.documentElement.style.setProperty('--hero-bg-image', `url('${bgUrl}')`)
})
```

### 3. Vue组件中使用computed (`Layout.vue`)
```vue
<script setup lang="ts">
import { computed } from 'vue'
import { withBase } from 'vitepress'

// 使用computed确保响应式更新
const backgroundSrc = computed(() => {
  return withBase(currentBackground.value)
})
</script>

<template>
  <img :src="backgroundSrc" alt="背景图" />
</template>
```

### 4. 主题切换器中的处理 (`ThemeSwitcher.vue`)
```vue
<script setup lang="ts">
// 显示用的路径（带base前缀）
const logos = computed(() => 
  LOGO_OPTIONS.map(logo => ({
    ...logo,
    path: withBase(logo.path)
  }))
)

// 但切换时仍使用原始路径
@click="switchLogo(LOGO_OPTIONS[index].path)"
</script>
```

## 🎯 修复效果

### Logo显示
- ✅ 导航栏Logo正常显示
- ✅ 主题切换器预览正常
- ✅ Logo切换功能正常

### 背景图显示
- ✅ 首页Hero背景图正常显示
- ✅ 背景切换功能正常
- ✅ 所有预览图正常

## 📝 关键要点

### withBase函数的作用
1. **自动添加base前缀**：`withBase('/logo.svg')` → `/kapok-docs/logo.svg`
2. **SSR兼容**：服务端渲染时也能正确处理
3. **开发/生产环境统一**：自动适配不同环境

### 正确的使用模式
```typescript
// ✅ 正确：在需要时调用withBase
const imageSrc = computed(() => withBase(rawPath.value))

// ❌ 错误：提前处理路径
const imageSrc = withBase('/static/image.png')
```

### 路径处理原则
1. **存储原始路径**：localStorage和状态中保存不带base的路径
2. **显示时处理**：在DOM更新时使用withBase
3. **避免重复处理**：不要对已处理的路径再次调用withBase

## 🔧 部署验证

### 本地开发
```bash
npm run docs:dev
# 访问 http://localhost:5173/kapok-docs/
```

### 生产构建
```bash
npm run docs:build
npm run docs:preview
# 访问 http://localhost:4173/kapok-docs/
```

### GitHub Pages
部署后访问：`https://username.github.io/kapok-docs/`

## 🚨 避免的错误

1. **不要手动拼接base路径**
```typescript
// ❌ 错误
const logoPath = `/kapok-docs/logo.svg`

// ✅ 正确
const logoPath = withBase('/logo.svg')
```

2. **不要重复处理路径**
```typescript
// ❌ 错误：重复处理
const processedPath = withBase(withBase('/logo.svg'))

// ✅ 正确：只处理一次
const processedPath = withBase('/logo.svg')
```

3. **不要在配置文件中使用withBase**
```typescript
// ❌ 错误：config.mts中不能使用withBase
logo: withBase('/logo.svg')

// ✅ 正确：直接使用相对路径
logo: '/logo.svg'
```

---

**🎉 现在Logo和背景图都应该能正确显示了！这是使用VitePress官方推荐方法的正确修复。**